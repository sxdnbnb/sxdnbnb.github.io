---
date: 2024-07-15 12:52:35
description: åŸºäºSpringbootå’ŒMybatisçš„å‘˜å·¥ç®¡ç†ç³»ç»Ÿ
title: å‘˜å·¥ç®¡ç†ç³»ç»Ÿ
tags:
  - é¡¹ç›®
permalink: /project/manager
categories:
  - Springbooté¡¹ç›®
coverImg: /ikun/ikun00000065.png
---


ä¸€ä¸ªåŸºäº`Springboot`å’Œ`Mybatis`å®ç°çš„å‘˜å·¥ç®¡ç†ç³»ç»Ÿï¼Œä½¿ç”¨`PageHelper`åˆ†é¡µå’Œäº‹åŠ¡å¤„ç†ã€‚

## [![github](https://img.shields.io/badge/GitHub-100000?style=for-the-badge&logo=github&logoColor=white)](https://github.com/sxdnbnb/manager)

## éœ€æ±‚
1. æ¥å£ä¸€ï¼šæ”¯æŒæŒ‰ç…§å§“åï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼‰ã€å·¥å·ã€æœºæ„idã€ æœºæ„åç§°ï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼‰ã€ çŠ¶æ€æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ ï¼ˆä»¥ä¸Šå››ä¸ªæ¡ä»¶å¯ä»¥è¾“å…¥ä¸€ä¸ªä¹Ÿå¯ä»¥è¾“å…¥å¤šä¸ªï¼‰ã€‚ç»“æœæ”¯æŒåˆ†é¡µå±•ç¤ºã€‚
2. æ¥å£äºŒï¼š æ”¯æŒè¾“å…¥æœºæ„åˆ—è¡¨ã€ æŸ¥è¯¢å¤šä¸ªæœºæ„ä¸‹çš„å‘˜å·¥ä¿¡æ¯ã€ç»“æœæ”¯æŒåˆ†é¡µå±•ç¤ºã€‚
3. æ¥å£ä¸‰ï¼šæ›´æ–°æŒ‡å®šå‘˜å·¥çš„çŠ¶æ€å€¼ã€æœºæ„å·ã€æœºæ„åç§°ï¼ˆä»¥ä¸Šä¸‰ä¸ªä¿¡æ¯å¯ä»¥è¾“å…¥ä¸€ä¸ªä¹Ÿå¯ä»¥è¾“å…¥å¤šä¸ªï¼‰
4. æ¥å£å››ï¼šæŒ‡å®šå·¥å·åˆ é™¤å‘˜å·¥ 
5. æ¥å£äº”ï¼šæ–°å¢å‘˜å·¥ä¿¡æ¯
6. æ¥å£å…­ï¼šä½¿ç”¨@Transactionalæ³¨è§£ï¼Œå®ç°äº‹åŠ¡å›æ»š

## é¡¹ç›®ç›®å½•ç»“æ„
```bash
â”‚  .gitignore
â”‚  pom.xml 
â””â”€src
    â”œâ”€main
    â”‚  â”œâ”€java
    â”‚  â”‚  â””â”€com
    â”‚  â”‚      â””â”€example
    â”‚  â”‚          â””â”€work3
    â”‚  â”‚              â”‚  Work3Application.java
    â”‚  â”‚              â”‚  
    â”‚  â”‚              â”œâ”€config  // å„ç§é…ç½®
    â”‚  â”‚              â”‚      WebExceptionAdvice.java
    â”‚  â”‚              â”‚      
    â”‚  â”‚              â”œâ”€controller // å‰ç«¯æ¥æ§åˆ¶å™¨ï¼ˆcontrollerå±‚ï¼‰ï¼Œè°ƒç”¨service
    â”‚  â”‚              â”‚      ManagerController.java
    â”‚  â”‚              â”‚      
    â”‚  â”‚              â”œâ”€dto //Data Transfer Objectï¼Œé‡æ„ç±»ï¼Œä»…ä¿ç•™éœ€è¦çš„å±æ€§
    â”‚  â”‚              â”‚      ManagerRequestDTO.java
    â”‚  â”‚              â”‚      ManagerWithDepartmentDTO.java
    â”‚  â”‚              â”‚      PageResult.java
    â”‚  â”‚              â”‚      Result.java
    â”‚  â”‚              â”‚      
    â”‚  â”‚              â”œâ”€entity // å®ä½“ç±»
    â”‚  â”‚              â”‚      Department.java
    â”‚  â”‚              â”‚      Manager.java
    â”‚  â”‚              â”‚      
    â”‚  â”‚              â”œâ”€mapper // mapperæ¥å£ï¼ˆdaoå±‚ï¼‰ï¼Œæ“ä½œæ•°æ®åº“
    â”‚  â”‚              â”‚      DepartmentMapper.java
    â”‚  â”‚              â”‚      ManagerMapper.java
    â”‚  â”‚              â”‚      
    â”‚  â”‚              â””â”€service // æœåŠ¡ç«¯æ¥å£ï¼ˆserviceå±‚ï¼‰
    â”‚  â”‚                  â”‚  ManagerService.java
    â”‚  â”‚                  â”‚  
    â”‚  â”‚                  â””â”€impl // æœåŠ¡ç«¯æ¥å£çš„å®ç°ç±»ï¼Œè°ƒç”¨mapper
    â”‚  â”‚                          ManagerServiceImpl.java
    â”‚  â”‚                          
    â”‚  â””â”€resources
    â”‚      â”‚  application.yaml // Springbootçš„é…ç½®é¡¹
    â”‚      â”‚  
    â”‚      â””â”€mapper // mapperæ¥å£çš„æ˜ å°„æ–‡ä»¶
    â”‚              DepartmentMapper.xml
    â”‚              ManagerMapper.xml
    â”‚              
    â””â”€test 
        â””â”€java
            â””â”€com
                â””â”€example
                    â””â”€work3
                            Work3ApplicationTests.java
```

## é¡¹ç›®åˆ›å»º
### 1. åˆ›å»ºSpringbooté¡¹ç›®
![Alt text](/picture/library/image.png)
### 2. æ·»åŠ Mavenä¾èµ–
![Alt text](/picture/library/image-1.png)

```xml
<!--pom.xmlæ–‡ä»¶å†…å®¹ -->
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.5.4</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>
    <groupId>com.example</groupId>
    <artifactId>work3</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>work3</name>
    <properties>
        <java.version>17</java.version>
    </properties>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>com.mysql</groupId>
            <artifactId>mysql-connector-j</artifactId>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>3.0.3</version>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>com.github.pagehelper</groupId>
            <artifactId>pagehelper-spring-boot-starter</artifactId>
            <version>2.1.0</version>
        </dependency>
    </dependencies>

</project>
```
### 3. åˆ é™¤å¤šä½™çš„æ–‡ä»¶ï¼Œå®Œå–„ç›®å½•ç»“æ„
![Alt text](/picture/manager/1.jpg)

### 4. ç¼–å†™Springbootçš„é…ç½®æ–‡ä»¶`application.yaml`
```yaml
server:
  port: 8081 # åº”ç”¨æœåŠ¡ç«¯å£å·

spring:
  application:
    name: work3 # åº”ç”¨åç§°
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver # MySQL é©±åŠ¨
    url: jdbc:mysql://localhost:3306/ebank?useSSL=false&serverTimezone=UTC # æ•°æ®åº“è¿æ¥ URL
    username: root # æ•°æ®åº“ç”¨æˆ·å
    password: 123456 # æ•°æ®åº“å¯†ç 
  jackson:
    default-property-inclusion: non_null # JSON åºåˆ—åŒ–æ—¶å¿½ç•¥ null å­—æ®µ

mybatis:
  mapper-locations: classpath:mapper/*.xml # Mapper XML æ–‡ä»¶è·¯å¾„
  type-aliases-package: com.example.work3.entity # å®ä½“ç±»æ‰€åœ¨åŒ…
  configuration:
    map-underscore-to-camel-case: true # å¼€å¯ä¸‹åˆ’çº¿è½¬é©¼å³°
    # log-impl: org.apache.ibatis.logging.stdout.StdOutImpl # æ‰“å° SQL åˆ°æ§åˆ¶å°
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl # æ›¿æ¢StdOutImplä¸ºlog4jå®ç°
pagehelper:
  helper-dialect: mysql # æ•°æ®åº“ç±»å‹ä¸º MySQL
  reasonable: true # é¡µç åˆç†åŒ–ï¼ˆpageNum <= 0 æ—¶è‡ªåŠ¨ç½®ä¸º 1ï¼‰
  support-methods-arguments: true # æ”¯æŒä»æ–¹æ³•å‚æ•°è·å–åˆ†é¡µå‚æ•°
  params: count=countSql # æŒ‡å®š count æŸ¥è¯¢çš„å‚æ•°åç§°

logging:
  level:
    com.example.work3.mapper: DEBUG # é…ç½®MapperåŒ…è·¯å¾„ï¼Œæ˜¾ç¤ºSQLè¯­å¥
    org.apache.ibatis: DEBUG  # MyBatisç›¸å…³æ—¥å¿—
    org.springframework.jdbc.datasource.DataSourceTransactionManager: DEBUG # æ‰“å°äº‹åŠ¡æäº¤/å›æ»šæ—¥å¿—
  # è‡ªå®šä¹‰æ§åˆ¶å°è¾“å‡ºæ ¼å¼ï¼ˆå¯é€‰ï¼‰
  pattern:
    console: "%d{HH:mm:ss.SSS} %-5level %logger{36} - %msg%n"
```

### 5. entityä¸­åˆ›å»ºå®ä½“ç±»
```java
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@AllArgsConstructor
@NoArgsConstructor
public class Manager {
    String  managerNo; // å·¥å·
    String  managerName; // å§“å
    String  departmentId; // æœºæ„å·
    String  departmentName; // æœºæ„åç§°
    String  status; // çŠ¶æ€ 0-æ­£å¸¸ 1-å¼‚å¸¸
}
```
```java
import lombok.Data;

@Data
public class Department {
    private Long id;
    private String departmentId;
    private String departmentName;
}
```
### 6. dtoä¸­åˆ›å»ºæœåŠ¡å™¨å“åº”ç»“æœç±»
```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Result {
    private Boolean success;
    private String errorMsg;
    private Object data;

    public static Result ok() {
        return new Result(true, null, null);
    }

    public static Result ok(Object data) {
        return new Result(true, null, data);
    }

    public static Result fail(String errorMsg) {
        return new Result(false, errorMsg, null);
    }
}
```
### 7. configä¸­åˆ›å»ºWebExceptionAdviceç±»
```java
import com.example.work3.dto.Result;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

@Slf4j
@RestControllerAdvice
public class WebExceptionAdvice {
    @ExceptionHandler(RuntimeException.class)
    public Result handleRuntimeException(RuntimeException e) {
        log.error(e.toString(), e);
        return Result.fail("æœåŠ¡å™¨å¼‚å¸¸");
    }
}
```
### 8. dtoä¸­åˆ›å»ºè¯·æ±‚ç±»å’Œåˆ†é¡µç»“æœç±»
```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class ManagerRequestDTO {
    // å…¬å…±å­—æ®µ
    private String managerNo;            // å·¥å·
    private String managerName;          // å§“å
    private List<String> departmentIds;  // æœºæ„IDåˆ—è¡¨
    private String departmentId;         // å•æœºæ„ID
    private String departmentName;       // æœºæ„åç§°
    private Integer status;              // çŠ¶æ€ 0-æ­£å¸¸ 1-å¼‚å¸¸

    // åˆ†é¡µå­—æ®µ
    private Integer pageNum;
    private Integer pageSize;
}
```
```java
@Data
public class ManagerWithDepartmentDTO {
    private Manager manager;
    private Department department;
}
```
```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class PageResult<T> {
    private List<T> list;  // æ•°æ®åˆ—è¡¨
    private long total;     // æ€»è®°å½•æ•°
    private int pageNum;    // å½“å‰é¡µç 
    private int pageSize;   // æ¯é¡µå¤§å°

    // é™æ€å·¥å‚æ–¹æ³•ï¼Œæ–¹ä¾¿ä» PageInfo åˆ›å»º PageResult
    public static <T> PageResult<T> of(PageInfo<T> pageInfo) {
        return new PageResult<>(
                pageInfo.getList(),
                pageInfo.getTotal(),
                pageInfo.getPageNum(),
                pageInfo.getPageSize()
        );
    }
}
```
### 9. serviceä¸­å®šä¹‰åŠŸèƒ½æ¥å£
```java
public interface ManagerService {
    // a.æ¥å£ä¸€:æ”¯æŒæŒ‰ç…§å§“å(æ¨¡ç³ŠæŸ»è¯¢)ã€å·¥å·ã€æœºæ„idã€æœºæ„åç§°(æ¨¡ç³ŠæŸ¥è¯¢)ã€çŠ¶æ€æŸ¥
    // è¯¢å‘˜å·¥ä¿¡æ¯(ä»¥ä¸Šå››ä¸ªæ¡ä»¶å¯ä»¥è¾“å…¥ä¸€ä¸ªä¹Ÿå¯ä»¥è¾“å…¥å¤šä¸ª)ï¼Œç»“æœæ”¯æŒåˆ†é¡µå±•ç¤º
    PageResult<Manager> queryManagers(ManagerRequestDTO dto);

    // b.æ¥å£äºŒ:æ”¯æŒè¾“å…¥æœºæ„åˆ—è¡¨ï¼ŒæŸ¥è¯¢å¤šä¸ªæœºæ„ä¸‹çš„å‘˜å·¥ä¿¡æ¯ï¼Œç»“æœæ”¯æŒåˆ†é¡µå±•ç¤º
    PageResult<Manager> queryByDepartments(ManagerRequestDTO dto);

    // c.æ¥å£ä¸‰:æ›´æ–°æŒ‡å®šå‘˜å·¥çš„çŠ¶æ€å€¼ã€æœºæ„å·ã€æœºæ„åç§°(ä»¥ä¸Šä¸‰ä¸ªä¿¡æ¯å¯ä»¥è¾“å…¥ä¸€ä¸ªä¹Ÿå¯
    // ä»¥è¾“å…¥å¤šä¸ª)
    Result updateManager(ManagerRequestDTO dto);

    // d.æ¥å£å››:æŒ‡å®šå·¥å·åˆ é™¤å‘˜å·¥
    Result deleteManager(String managerNo);

    // e.æ¥å£äº”:æ–°å¢å‘˜å·¥ä¿¡æ¯
    Result addManager(Manager manager);

    // f.æ¥å£å…­ï¼šåŒæ—¶æ’å…¥éƒ¨é—¨å’Œå‘˜å·¥
    void addManagerWithDepartment(Manager manager, Department department);
}
```
### 10. mapperä¸­åˆ›å»ºæ“ä½œå®ä½“ç±»çš„ManagerMapperæ¥å£, ç„¶åå¯åŠ¨ç±»ä¸ŠåŠ æ³¨è§£@MapperScan("com.example.work3.mapper")æ‰«æ Mapper ç±»
```java
// ç”¨äº†@MapperScan("com.example.work3.mapper")å°±å¯ä»¥ä¸ç”¨@Mapper
@Mapper
public interface ManagerMapper {
    // æ¥å£ä¸€: æ¡ä»¶åˆ†é¡µæŸ¥è¯¢
    List<Manager> queryManagers(ManagerRequestDTO dto);

    // æ¥å£äºŒ: æŒ‰æœºæ„åˆ—è¡¨æŸ¥è¯¢
    List<Manager> queryManagersByDepartments(ManagerRequestDTO dto);

    // æ¥å£ä¸‰: æ›´æ–°æŒ‡å®šå‘˜å·¥ä¿¡æ¯
    int updateManager(ManagerRequestDTO dto);

    // æ¥å£å››: åˆ é™¤å‘˜å·¥
    int deleteManager(String managerNo);

    // æ¥å£äº”: æ–°å¢å‘˜å·¥
    int insertManager(Manager manager);
}
```
```java
@Mapper
public interface DepartmentMapper {
    // æ¥å£å…­
    int insertDepartment(Department department);
}
```
### 11. ManagerMapper.xmlä¸­å†™mybatisè¯­å¥
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.work3.mapper.ManagerMapper">

    <!-- æ¥å£ä¸€ï¼šæŒ‰æ¡ä»¶åˆ†é¡µæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ -->
    <select id="queryManagers" resultType="com.example.work3.entity.Manager">
        SELECT manager_no, manager_name, department_id, department_name, status
        FROM manager_info
        <where>
            <if test="managerNo != null and managerNo != ''">
                AND manager_no = #{managerNo}
            </if>
            <if test="managerName != null and managerName != ''">
                AND manager_name LIKE CONCAT('%', #{managerName}, '%')
            </if>
            <if test="departmentId != null and departmentId != ''">
                AND department_id = #{departmentId}
            </if>
            <if test="departmentName != null and departmentName != ''">
                AND department_name LIKE CONCAT('%', #{departmentName}, '%')
            </if>
            <if test="status != null">
                AND status = #{status}
            </if>
        </where>
    </select>

    <!-- æ¥å£äºŒï¼šæŒ‰æœºæ„åˆ—è¡¨åˆ†é¡µæŸ¥è¯¢å‘˜å·¥ -->
    <select id="queryManagersByDepartments" resultType="com.example.work3.entity.Manager">
        SELECT manager_no, manager_name, department_id, department_name, status
        FROM manager_info
        <where>
            <if test="departmentIds != null and departmentIds.size > 0">
                AND department_id IN
                <foreach collection="departmentIds" item="id" open="(" separator="," close=")">
                    #{id}
                </foreach>
            </if>
        </where>
    </select>

    <!-- æ¥å£ä¸‰ï¼šæ›´æ–°å‘˜å·¥ä¿¡æ¯ -->
    <update id="updateManager" parameterType="com.example.work3.dto.ManagerRequestDTO">
        UPDATE manager_info
        <set>
            <if test="managerName != null and managerName != ''">
                manager_name = #{managerName},
            </if>
            <if test="departmentId != null and departmentId != ''">
                department_id = #{departmentId},
            </if>
            <if test="departmentName != null and departmentName != ''">
                department_name = #{departmentName},
            </if>
            <if test="status != null">
                status = #{status},
            </if>
        </set>
        WHERE manager_no = #{managerNo}
    </update>

    <!-- æ¥å£å››ï¼šåˆ é™¤å‘˜å·¥ -->
    <delete id="deleteManager" parameterType="string">
        DELETE FROM manager_info
        WHERE manager_no = #{managerNo}
    </delete>

    <!-- æ¥å£äº”ï¼šæ–°å¢å‘˜å·¥ -->
    <insert id="insertManager" parameterType="com.example.work3.entity.Manager">
        INSERT INTO manager_info (manager_no, manager_name, department_id, department_name, status)
        VALUES (#{managerNo}, #{managerName}, #{departmentId}, #{departmentName}, #{status})
    </insert>

</mapper>
```
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.work3.mapper.DepartmentMapper">
    <!-- æ¥å£å…­ï¼šåŒæ—¶æ–°å¢å‘˜å·¥å’Œéƒ¨é—¨ -->
    <insert id="insertDepartment" parameterType="com.example.work3.entity.Department">
        INSERT INTO department_info (department_id, department_name)
        VALUES (#{departmentId}, #{departmentName})
    </insert>
</mapper>
```
### 12. implä¸­åˆ›å»ºå®ç°åŠŸèƒ½æ¥å£çš„å®ç°ç±»
```java
@Service
public class ManagerServiceImpl implements ManagerService {
    @Autowired
    private ManagerMapper managerMapper;
    @Autowired
    private DepartmentMapper departmentMapper;

    // æ¥å£ä¸€
    @Override
    public PageResult<Manager> queryManagers(ManagerRequestDTO dto) {
        PageHelper.startPage(dto.getPageNum(), dto.getPageSize());
        List<Manager> list = managerMapper.queryManagers(dto);
        PageInfo<Manager> pageInfo = new PageInfo<>(list);
        return PageResult.of(pageInfo);
    }

    // æ¥å£äºŒ
    @Override
    public PageResult<Manager> queryByDepartments(ManagerRequestDTO dto) {
        PageHelper.startPage(dto.getPageNum(), dto.getPageSize());
        List<Manager> list = managerMapper.queryManagersByDepartments(dto);
        PageInfo<Manager> pageInfo = new PageInfo<>(list);
        return PageResult.of(pageInfo);
    }

    // æ¥å£ä¸‰
    @Override
    public Result updateManager(ManagerRequestDTO dto) {
        // å‚æ•°æ ¡éªŒ
        if (dto.getManagerNo() == null || dto.getManagerNo().isEmpty()) {
            return Result.fail("å·¥å·ä¸èƒ½ä¸ºç©º");
        }

        int rows = managerMapper.updateManager(dto);
        if (rows > 0) {
            return Result.ok("æ›´æ–°æˆåŠŸ");
        } else {
            return Result.fail("æœªæ‰¾åˆ°è¯¥å‘˜å·¥æˆ–æ²¡æœ‰éœ€è¦æ›´æ–°çš„å­—æ®µ");
        }
    }

    // æ¥å£å››
    @Override
    public Result deleteManager(String managerNo) {
        if (managerNo == null || managerNo.isEmpty()) {
            return Result.fail("å·¥å·ä¸èƒ½ä¸ºç©º");
        }

        int rows = managerMapper.deleteManager(managerNo);
        if (rows > 0) {
            return Result.ok("åˆ é™¤æˆåŠŸ");
        } else {
            return Result.fail("æœªæ‰¾åˆ°è¯¥å‘˜å·¥");
        }
    }

    // æ¥å£äº” 
    @Override
    public Result addManager(Manager manager) {
        if (manager.getManagerNo() == null || manager.getManagerNo().isEmpty()) {
            return Result.fail("å·¥å·ä¸èƒ½ä¸ºç©º");
        }
        if (manager.getManagerName() == null || manager.getManagerName().isEmpty()) {
            return Result.fail("å§“åä¸èƒ½ä¸ºç©º");
        }

        int rows = managerMapper.insertManager(manager);
        if (rows > 0) {
            return Result.ok("æ–°å¢æˆåŠŸ");
        } else {
            return Result.fail("æ–°å¢å¤±è´¥");
        }
    }

    // æ¥å£å…­
    @Override
    @Transactional(rollbackFor = Exception.class) // å¼€å¯äº‹åŠ¡å›æ»š
    public void addManagerWithDepartment(Manager manager, Department department) {
        // 1. æ’å…¥éƒ¨é—¨
        departmentMapper.insertDepartment(department);

        // 2. æ¨¡æ‹Ÿå¼‚å¸¸
        if (manager.getManagerNo() == null) {
            throw new RuntimeException("Manager ç¼–å·ä¸èƒ½ä¸ºç©ºï¼");
        }

        // 3. æ’å…¥å‘˜å·¥
        managerMapper.insertManager(manager);
    }

}
```
### 13. controllerä¸­åˆ›å»ºManagerControllerç±»
```java
@Slf4j
@RestController
@RequestMapping("/managers")
public class ManagerController {
    @Autowired
    private ManagerService managerService;

    // æ¥å£1
    @PostMapping("/query")
    public Result queryManagers(@RequestBody ManagerRequestDTO dto) {
        PageResult<Manager> pageResult = managerService.queryManagers(dto);
        return Result.ok(pageResult);
    }

    // æ¥å£2
    @PostMapping("/queryByDepartments")
    public Result queryManagersByDepartments(@RequestBody ManagerRequestDTO dto) {
        PageResult<Manager> pageResult = managerService.queryByDepartments(dto);
        return Result.ok(pageResult);
    }

    // æ¥å£3
    @PutMapping("/update")
    public Result updateManager(@RequestBody ManagerRequestDTO dto) {
        return managerService.updateManager(dto);
    }

    // æ¥å£4
    @DeleteMapping("/{managerNo}")
    public Result deleteManager(@PathVariable String managerNo) {
        return managerService.deleteManager(managerNo);
    }

    // æ¥å£5
    @PostMapping("/add")
    public Result addManager(@RequestBody Manager manager) {
        return managerService.addManager(manager);
    }

    // æ’å…¥å‘˜å·¥åŒæ—¶æ’å…¥éƒ¨é—¨
    @PostMapping("/addWithDepartment")
    public Result addWithDepartment(@RequestBody ManagerWithDepartmentDTO dto) {
        try {
            managerService.addManagerWithDepartment(dto.getManager(), dto.getDepartment());
            return Result.ok("æ·»åŠ æˆåŠŸ");
        } catch (Exception e) {
            log.error("æ·»åŠ å‘˜å·¥åŠéƒ¨é—¨å¤±è´¥ï¼Œäº‹åŠ¡å·²å›æ»š", e);
            return Result.fail("æ·»åŠ å¤±è´¥ï¼š" + e.getMessage());
        }
    }
}
```
### 14. å¯åŠ¨æœåŠ¡å¹¶åœ¨PostManåšæ¥å£æµ‹è¯•

### 15. æ–°å¢å‘˜å·¥å¹¶è·å–æ’å…¥åçš„ä¸»é”®å€¼
```xml
<insert id="insertManager" parameterType="com.example.work3.entity.Manager" useGeneratedKeys="true" keyProperty="managerId">
        INSERT INTO manager_info (manager_no, manager_name, department_id, department_name, status)
        VALUES (#{managerNo}, #{managerName}, #{departmentId}, #{departmentName}, #{status})
</insert>
```
```java
@PostMapping("/add")
public Result addManager(@RequestBody Manager manager) {
    System.out.println("æ’å…¥å‰ID: " + manager.getManagerId());
    Result result = managerService.addManager(manager);
    System.out.println("æ’å…¥åID: " + manager.getManagerId());
    return result;
}
```

## é‡åˆ°çš„å¼‚å¸¸åŠè§£å†³åŠæ³•
>[!WARNING]
>Failed to parse mapping resource: 'file [D:\JavaProject_IDEA\work3\target\classes\mapper\ManagerMapper.xml]'

>ğŸ’¡æ’æŸ¥æ–¹æ³•
>1. æ£€æŸ¥`XML`è¯­æ³•æ˜¯å¦æœ‰è¯¯
æ£€æŸ¥æ‰€æœ‰ `<if>ã€<set>ã€<foreach> `æ ‡ç­¾æ˜¯å¦æˆå¯¹é—­åˆã€‚\
æ£€æŸ¥` <set> `å†…æ˜¯å¦æœ‰å¤šä½™çš„ `,`
>2. Mapper XML æ–‡ä»¶è·¯å¾„ä¸å¯¹\
åœ¨ `application.yaml` ä¸­ï¼š\
mybatis:\
  mapper-locations: classpath:mapper/*.xml\
ç¡®ä¿ `ManagerMapper.xml` å®é™…è·¯å¾„æ˜¯ï¼š
`src/main/resources/mapper/ManagerMapper.xml`

>[!WARNING]
>org.springframework.beans.factory.BeanDefinitionStoreException: Invalid bean definition with name 'managerMapper' ... Invalid value type for attribute 'factoryBeanObjectType': java.lang.String

>ğŸ’¡æ’æŸ¥æ–¹æ³•
> 1. Mapper æ²¡æœ‰è¢«æ­£ç¡®æ‰«æ\
å¦‚æœä½ ä½¿ç”¨äº† `@MapperScan("com.example.work3.mapper")`ï¼ŒSpring ä¼šè‡ªåŠ¨æ‰«ææ¥å£å¹¶ç”Ÿæˆ `Mapper Bean`ã€‚\
å¦‚æœåœ¨` Mapper æ¥å£`ä¸Šç”¨ `@Mapper` æ³¨è§£ï¼Œä¹Ÿå¯ä»¥å•ç‹¬è¢«æ‰«æã€‚
å¦‚æœé…ç½®å†²çªæˆ–è·¯å¾„é”™è¯¯ï¼Œå°±å¯èƒ½å‡ºç° `Invalid value type for attribute 'factoryBeanObjectType'`ã€‚
> 2. ä¾èµ–ç‰ˆæœ¬ä¸å…¼å®¹\
ä¾‹å¦‚ `MyBatis` çš„ç‰ˆæœ¬ä¸ `Spring Boot` ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œä¹Ÿå¯èƒ½æŠ¥è¿™ä¸ªé”™ã€‚

> [!IMPORTANT]
>ç‰¹åˆ«æ˜¯`Spring Boot 2.x/3.x`ä¸ `MyBatis 3.x`çš„ç‰ˆæœ¬ä¸€å®šè¦ç›¸åŒ¹é…ã€‚

## Springbootä½¿ç”¨Log4j2è®°å½•æ—¥å¿—

1. ä¿®æ”¹ä¾èµ–

éœ€è¦æ’é™¤`Spring Boot`é»˜è®¤çš„`Logback`ï¼Œæ·»åŠ `Log4j2`æ”¯æŒï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="info">
    <Properties>
        <!-- å®šä¹‰å¸¦é«˜äº®çš„æ—¥å¿—æ ¼å¼ -->
        <Property name="LOG_PATTERN">
            %d{yyyy-MM-dd HH:mm:ss} %highlight{[%t] %-5level} %style{%logger{50}}{cyan} - %msg%n
        </Property>
    </Properties>

    <Appenders>
        <!-- æ§åˆ¶å°è¾“å‡º -->
        <Console name="Console" target="SYSTEM_OUT" follow="true">
            <PatternLayout pattern="${LOG_PATTERN}" disableAnsi="false"/>
        </Console>

        <!-- æ•°æ®æºç›¸å…³æ—¥å¿—æ–‡ä»¶è¾“å‡º -->
        <RollingFile name="datasource" immediateFlush="true"
                     fileName="log/datasource/datasource.log"
                     filePattern="log/datasource/datasource - %d{yyyy-MM-dd HH_mm_ss}.log.gz">
            <PatternLayout pattern="${LOG_PATTERN}"/>
            <Policies>
                <SizeBasedTriggeringPolicy size="20MB"/>
            </Policies>
        </RollingFile>

        <!-- æ¡†æ¶ç›¸å…³æ—¥å¿—æ–‡ä»¶è¾“å‡º -->
        <RollingFile name="framework" immediateFlush="true"
                     fileName="log/framework/framework.log"
                     filePattern="log/framework/framework - %d{yyyy-MM-dd HH_mm_ss}.log.gz">
            <PatternLayout pattern="${LOG_PATTERN}"/>
            <Policies>
                <SizeBasedTriggeringPolicy size="20MB"/>
            </Policies>
        </RollingFile>
    </Appenders>

    <Loggers>
        <!-- MyBatis SQLæ—¥å¿— -->
        <Logger name="com.example.work3.mapper" level="DEBUG" additivity="true">
            <AppenderRef ref="Console"/>
            <AppenderRef ref="datasource"/>
        </Logger>

        <!-- MyBatisæ¡†æ¶æ—¥å¿— -->
        <Logger name="org.apache.ibatis" level="DEBUG" additivity="true">
            <AppenderRef ref="Console"/>
        </Logger>

        <!-- Springæ¡†æ¶æ—¥å¿— -->
        <Logger name="org.springframework" level="INFO" additivity="true">
            <AppenderRef ref="Console"/>
        </Logger>

        <!-- æ ¹Logger -->
        <Root level="INFO">
            <!--<AppenderRef ref="Console"/>-->
            <AppenderRef ref="framework"/>
        </Root>
    </Loggers>
</Configuration>
```

4. Log4j2æ ¼å¼åŒ–æ¨¡å¼è¯¦è§£

Log4j2çš„æ—¥å¿—æ ¼å¼ä¸Logbackç±»ä¼¼ä½†æœ‰ç»†å¾®å·®åˆ«ï¼š

```xml
<Property name="LOG_PATTERN">
    %d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{50} - %msg%n
</Property>
```

å„éƒ¨åˆ†è¯´æ˜ï¼š
- `%d{yyyy-MM-dd HH:mm:ss.SSS}`ï¼šæ—¶é—´æˆ³æ ¼å¼
- `[%t]`ï¼šçº¿ç¨‹å
- `%-5level`ï¼šæ—¥å¿—çº§åˆ«ï¼Œå·¦å¯¹é½5å­—ç¬¦å®½åº¦
- `%logger{50}`ï¼šLoggeråç§°ï¼Œæœ€å¤š50å­—ç¬¦
- `%msg`ï¼šæ—¥å¿—æ¶ˆæ¯
- `%n`ï¼šæ¢è¡Œç¬¦

### æ—¥å¿—çº§åˆ«
åœ¨log4j2ä¸­ï¼Œå…±æœ‰8ä¸ªçº§åˆ«ï¼ŒæŒ‰ç…§ä»ä½åˆ°é«˜ä¸ºï¼š

ALL < TRACE < DEBUG < INFO < WARN < ERROR < FATAL < OFFã€‚

- All:æœ€ä½ç­‰çº§çš„ï¼Œç”¨äºæ‰“å¼€æ‰€æœ‰æ—¥å¿—è®°å½•.
- Trace:æ˜¯è¿½è¸ªï¼Œå°±æ˜¯ç¨‹åºæ¨è¿›ä¸€ä¸‹.
- Debug:æŒ‡å‡ºç»†ç²’åº¦ä¿¡æ¯äº‹ä»¶å¯¹è°ƒè¯•åº”ç”¨ç¨‹åºæ˜¯éå¸¸æœ‰å¸®åŠ©çš„.
- Info:æ¶ˆæ¯åœ¨ç²—ç²’åº¦çº§åˆ«ä¸Šçªå‡ºå¼ºè°ƒåº”ç”¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹.
- Warn:è¾“å‡ºè­¦å‘ŠåŠwarnä»¥ä¸‹çº§åˆ«çš„æ—¥å¿—.
- Error:è¾“å‡ºé”™è¯¯ä¿¡æ¯æ—¥å¿—.
- Fatal:è¾“å‡ºæ¯ä¸ªä¸¥é‡çš„é”™è¯¯äº‹ä»¶å°†ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºçš„é€€å‡ºçš„æ—¥å¿—.
- OFF:æœ€é«˜ç­‰çº§çš„ï¼Œç”¨äºå…³é—­æ‰€æœ‰æ—¥å¿—è®°å½•

ç¨‹åºä¼šæ‰“å°é«˜äºæˆ–ç­‰äºæ‰€è®¾ç½®çº§åˆ«çš„æ—¥å¿—ï¼Œè®¾ç½®çš„æ—¥å¿—ç­‰çº§è¶Šé«˜ï¼Œæ‰“å°å‡ºæ¥çš„æ—¥å¿—å°±è¶Šå°‘ã€‚


